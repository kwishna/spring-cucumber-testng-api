# üå± Spring Dependency Injection Explained ‚Äî Step by Step

> **Goal:** Understand how Spring automatically injects your `DriverFactory` into the `webDriver()` method.

---

## üéØ The Core Question

```java
@Bean
public WebDriver webDriver(DriverFactory factory) {  // ‚Üê How does this get the factory?
    return factory.createWebDriver(browser);
}
```

You never call `new DriverFactory()` yourself ‚Äî yet, magically, it‚Äôs available.
Let‚Äôs break down exactly **how Spring makes that happen**.

---

## üß© Step 1: Spring Discovers Components

When your app starts, Spring scans the packages you specify:

```java
@ComponentScan(basePackages = "org.spring.bdd")  // from TestConfig.java
```

Spring finds your factory:

```java
@Component  // üëà "Spring, please manage me as a bean!"
public class DriverFactory {

    @Value("${browser:chrome}")
    private String defaultBrowser;

    public WebDriver createWebDriver(String browser) {
        // Implementation
    }
}
```

### üß† What Spring Does Behind the Scenes

```java
DriverFactory driverFactory = new DriverFactory();

// Injects all @Value properties:
driverFactory.defaultBrowser = "chrome";

// Stores it in the ApplicationContext (like a registry of beans)
applicationContext.put("driverFactory", driverFactory);
```

Spring now ‚Äúowns‚Äù this instance. You don‚Äôt need to `new` it again.

---

## üß± Step 2: Spring Finds @Configuration Classes

```java
@Configuration  // üëà "I declare beans here!"
public class WebDriverConfig {

    @Bean(destroyMethod = "quit")
    @Scope("cucumber-glue")
    public WebDriver webDriver(DriverFactory factory) {  // üëà Parameter injection
        return factory.createWebDriver(browser);
    }
}
```

### üß† What Spring Does

Spring registers a ‚Äúrecipe‚Äù for this bean:

```java
beanDefinitions.put("webDriver", {
    type: WebDriver.class,
    scope: "cucumber-glue",
    parameters: [DriverFactory.class],
    destroyMethod: "quit"
});
```

At this point, **Spring knows**:

* How to create a `WebDriver`
* That it needs a `DriverFactory` to do so
* When to destroy it (`quit()`)

---

## üöÄ Step 3: When a Test Needs WebDriver

```java
public class LoginSteps extends BaseUiSteps {

    @Autowired
    private WebDriver driver;  // üëà "Give me a WebDriver, please!"
}
```

### üîç What Happens Internally

```java
// 1Ô∏è‚É£ Spring checks its registry
BeanDefinition def = beanDefinitions.get("webDriver");

// 2Ô∏è‚É£ It sees: needs DriverFactory
DriverFactory factory = applicationContext.get("driverFactory");

// 3Ô∏è‚É£ It finds your WebDriverConfig class
WebDriverConfig config = applicationContext.get("webDriverConfig");

// 4Ô∏è‚É£ It calls your @Bean method
WebDriver driver = config.webDriver(factory);

// 5Ô∏è‚É£ It injects the result
loginSteps.driver = driver;
```

Boom üí• ‚Äî dependency injected.

---

## üîÑ Lifecycle Flow Diagram

```
Application Startup
    ‚Üì
[1] Component Scan
     ‚Üí Finds @Component classes (DriverFactory)
     ‚Üí Creates and stores them in ApplicationContext
    ‚Üì
[2] @Configuration Processing
     ‚Üí Registers @Bean definitions (WebDriver)
     ‚Üí Notes dependencies (DriverFactory)
    ‚Üì
[3] Test Execution
     ‚Üí @Autowired WebDriver requested
     ‚Üí Spring resolves dependencies
     ‚Üí Calls webDriver(factory)
     ‚Üí Injects into your step class
```

---

## üß† Key Spring Concepts Refresher

| Annotation       | Meaning                                 | Example                     |
| ---------------- | --------------------------------------- | --------------------------- |
| `@Component`     | "I‚Äôm a managed bean."                   | `DriverFactory`             |
| `@Configuration` | "I define other beans."                 | `WebDriverConfig`           |
| `@Bean`          | "Here‚Äôs how to create a bean instance." | `webDriver()`               |
| `@Autowired`     | "Inject a bean into me."                | `private WebDriver driver;` |

### Method Parameter Injection

You can inject any managed bean directly via method parameters:

```java
@Bean
public WebDriver webDriver(
    DriverFactory factory,     // Injected
    Environment env,           // Injected
    SomeOtherBean bean         // Injected
) {
    return factory.createWebDriver(browser);
}
```

---

## ü™µ Add Logging to See It in Action

```java
@Component
public class DriverFactory {

    private static final Logger log = LogManager.getLogger(DriverFactory.class);

    public DriverFactory() {
        log.info("üè≠ DriverFactory constructor called");
    }

    public WebDriver createWebDriver(String browser) {
        log.info("üöó Creating WebDriver for: {}", browser);
        return new ChromeDriver();
    }
}

@Configuration
public class WebDriverConfig {

    private static final Logger log = LogManager.getLogger(WebDriverConfig.class);

    @Bean(destroyMethod = "quit")
    @Scope("cucumber-glue")
    public WebDriver webDriver(DriverFactory factory) {
        log.info("üîß @Bean method called with factory: {}", factory);
        WebDriver driver = factory.createWebDriver("chrome");
        log.info("‚úÖ WebDriver created: {}", driver);
        return driver;
    }
}
```

**Expected Console Output:**

```
[INFO] üè≠ DriverFactory constructor called
[INFO] ‚öôÔ∏è WebDriverConfig loaded
[INFO] üîß webDriver() @Bean method called
[INFO] üì¶ DriverFactory injected: org.spring.bdd.envs.DriverFactory@1a2b3c4d
[INFO] üöó Creating WebDriver for: chrome
[INFO] ‚úÖ WebDriver created: ChromeDriver: chrome on MAC (session 1234)
```

---

## ‚ùì Common Questions

### Q: Who calls `webDriver()`?

> Spring‚Äôs **ApplicationContext** calls it when a `WebDriver` is needed.

---

### Q: How does Spring inject `DriverFactory`?

1. It scans and creates all `@Component` beans first
2. It stores them in the `ApplicationContext`
3. When `webDriver()` is called, Spring sees it requires a `DriverFactory`
4. Spring retrieves and injects that existing bean instance

---

### Q: What if `DriverFactory` doesn‚Äôt exist?

> You‚Äôll get:
>
> ```
> No qualifying bean of type 'DriverFactory' available
> ```

Spring can only inject managed beans.

---

### Q: Can I inject multiple dependencies?

Absolutely:

```java
@Bean
public WebDriver webDriver(
    DriverFactory factory,
    Environment env,
    ApplicationContext ctx
) { ... }
```

---

### Q: Why use method parameters instead of `@Autowired` fields?

Both are valid ‚Äî but parameter injection is **cleaner for @Bean methods**:

```java
// ‚úÖ Preferred (parameter injection)
@Bean
public WebDriver webDriver(DriverFactory factory) { ... }

// üëå Also works (field injection)
@Autowired
private DriverFactory factory;
@Bean
public WebDriver webDriver() { ... }
```

---

## üß≠ Summary

| Step | Description                                                     |
| ---- | --------------------------------------------------------------- |
| 1Ô∏è‚É£  | Spring scans packages and finds `@Component` classes            |
| 2Ô∏è‚É£  | It creates `DriverFactory` and injects its properties           |
| 3Ô∏è‚É£  | It registers `webDriver()` as a bean definition                 |
| 4Ô∏è‚É£  | When a `WebDriver` is needed, Spring calls `webDriver(factory)` |
| 5Ô∏è‚É£  | The created driver is injected wherever `@Autowired`            |

---

### üí° The Magic in One Snippet

```java
// You write:
@Bean
public WebDriver webDriver(DriverFactory factory) {
    return factory.createWebDriver(browser);
}

// Spring does:
DriverFactory factory = applicationContext.getBean(DriverFactory.class);
WebDriver driver = webDriverConfig.webDriver(factory);
```

This is **Inversion of Control (IoC)** ‚Äî
You declare what you need, **Spring provides it**. üå±‚ú®

---
